<html>
<head>
<title>Development Containers | GitKon 2022 | Brigit Murtaugh, Microsoft</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>开发容器| GitKon 2022 | Brigit Murtaugh，微软</h1>
<blockquote>原文：<a href="https://www.gitkraken.com/gitkon/development-containers-brigit-murtaugh#0001-01-01">https://www.gitkraken.com/gitkon/development-containers-brigit-murtaugh#0001-01-01</a></blockquote><div><div class="elementor-widget-container">
			
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><p class="wp-block-embed__wrapper"><iframe title="Development Containers | GitKon 2022 | Brigit Murtaugh, Microsoft" src="https://www.youtube.com/embed/6IesIsmzzRc?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">视频</iframe></p></figure>



<p aria-hidden="true" class="wp-block-spacer"/>



<p>容器在部署时一直被用来标准化应用程序，但现在有很好的机会来支持其他场景，包括持续集成(CI)、测试自动化和全功能编码环境。</p>



<p>开发容器为这些场景提供了环境，并确保您的项目拥有所需的工具和软件。虽然部署和开发容器可能彼此相似，但您可能不希望在开发过程中使用的部署映像中包含工具。</p>



<p aria-hidden="true" class="wp-block-spacer"/>





<p aria-hidden="true" class="wp-block-spacer"/>



<p>自2019年以来，Visual Studio代码中已经<a href="https://code.visualstudio.com/docs/remote/containers" target="_blank" rel="noreferrer noopener">支持开发容器，最近</a><a href="https://github.com/features/codespaces" target="_blank" rel="noreferrer noopener"> GitHub代码空间</a>也支持开发容器。这种支持得到了<strong> devcontainer.json </strong>的支持，这是一种带有注释的结构化JSON(jsonc)元数据格式，用于配置容器化的环境。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h2><strong>开发容器规格</strong></h2>



<p>随着容器化生产工作负载变得越来越普遍，开发容器在VS代码之外的场景中变得越来越有用。微软和GitHub的一个团队已经启动了开发容器规范，该规范允许任何人使用任何工具来配置一致的开发环境。</p>



<p>您可以在相关的<a href="https://containers.dev/implementors/spec/" target="_blank" rel="noreferrer noopener"> containers.dev spec网站</a>上浏览该规范，并在<a href="https://containers.dev/" target="_blank" rel="noreferrer noopener"> devcontainers/spec </a> repo中查看该规范及其活动提案。与开发容器和规范工作相关的其他repos也在<a href="https://github.com/devcontainers" target="_blank" rel="noreferrer noopener"> devcontainers GitHub org </a>中托管。</p>



<p>让我们更深入地了解开发容器规范，以及如何立即开始使用开发容器:</p>







<p aria-hidden="true" class="wp-block-spacer"/>



<h2><strong>开发容器CLI </strong></h2>



<p>开发容器CLI是该规范的开源参考实现。它可以在<a href="https://github.com/devcontainers/cli" target="_blank" rel="noreferrer noopener"> devcontainers/cli </a>存储库中获得。</p>



<p>当像VS Code和Codespaces这样的工具在用户的项目中检测到<code>devcontainer.json</code>时，它们使用CLI来配置开发容器。这就打开了这个CLI，使得单个用户和其他工具可以读取devcontainer.json元数据并从中创建dev容器。</p>



<p>开发容器CLI既可以直接使用，也可以集成到产品体验中，类似于今天它与远程容器和代码空间的集成。dev container CLI目前既支持简单的单个容器选项，也支持与用于多容器场景的<a href="https://docs.docker.com/compose/" target="_blank" rel="noreferrer noopener"> Docker Compose </a>集成。</p>



<p>dev容器CLI也可用于预构建映像，以加快启动时间。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h2><strong>用于构建和测试的开发容器</strong></h2>



<p>除了可重复的设置之外，相同的开发容器还提供了一致性，以避免开发人员之间的环境特定问题，以及集中的构建和测试自动化服务。</p>



<p>GitHub动作和Azure DevOps任务在<a href="https://github.com/devcontainers/ci/blob/main/README.md" target="_blank" rel="noopener"> devcontainers/ci </a>中可用，用于在持续集成(ci)构建中运行存储库的开发容器。这允许您重用用于本地开发的相同设置，以便在CI中构建和测试您的代码。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h2><strong>开发容器特性</strong></h2>



<p>开发容器中的特性是安装代码的自包含单元，旨在安装到各种基础容器映像上。</p>



<p>微软和VS Code的团队最近开源了一个新的<a href="https://code.visualstudio.com/blogs/2022/09/15/dev-container-features" target="_blank" rel="noreferrer noopener"> devcontainers/features </a>库。从devcontainers/features中引用特性就像在您的<code>devcontainer.json</code>中添加一个<code>features</code>属性一样简单。</p>



<p>以下示例安装了go和docker-in-docker功能:</p>



<p><code>"name": "my-project-devcontainer",</code></p>



<p><code>"image": "mcr.microsoft.com/devcontainers/base:ubuntu", // Any generic, debian-based  image. </code></p>



<p><code>"features": { </code></p>



<p><code>"ghcr.io/devcontainers/features/go:1": { </code></p>



<p><code>"version": "1.18" </code></p>



<p><code>}, </code></p>



<p><code>"ghcr.io/devcontainers/features/docker-in-docker:1": {</code></p>



<p><code>"version": "latest",</code></p>



<p><code>"moby": true </code></p>



<p><code>} </code></p>



<p><code>}</code></p>



<p>以下是官方和社区支持的开发容器特性:</p>



<p aria-hidden="true" class="wp-block-spacer"/>





<p aria-hidden="true" class="wp-block-spacer"/>



<h3><strong>开发容器特性创作</strong></h3>



<p>如果您想创建自己的开发容器特性，新的<a href="https://github.com/microsoft/dev-container-features-template" target="_blank" rel="noreferrer noopener">开发容器特性模板库</a>是一个很好的起点。除了包含给定特性内容的良好模板，该模板还包含GitHub Actions工作流，使用GitHub容器注册表为您的帐户快速发布它们，让您尽快启动并运行。</p>



<p>开发容器功能有两个必需的组件:</p>



<ol><li><code>install.sh</code>:安装入口点脚本。这在概念上作为映像Dockerfile的一层添加，并在构建时执行。这个入口点脚本可以安装语言(即ruby)和工具(即GitHub CLI)。</li><li><code>devcontainer-feature.json</code>:它包含了关于特性的元数据，一组可以在安装过程中传递给特性的安装脚本的选项，以及将被合并到最终开发容器中的<code>devcontainer.json</code>的“片段”。</li></ol>



<p aria-hidden="true" class="wp-block-spacer"/>



<p>Dev容器特性可以用多种语言编写，最简单的是<a href="https://www.gitkraken.com/blog/shell-scripting" target="_blank" rel="noreferrer noopener"> shell脚本</a>。如果一个特性是用不同的语言创作的，那么关于该特性的信息应该包含在元数据中，以便用户可以做出明智的决定。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h3><strong>开发容器特性分布</strong></h3>



<p>开发容器特性以tarballs的形式分发。tarball包含特性子目录的全部内容，包括<code>devcontainer-feature.json</code>、<code>install.sh</code>和目录中的任何其他文件。</p>



<p>开放容器倡议(Open Container Initiative)又称OCI，定义了容器和容器资源的行业标准。微软将开发容器特性视为OCI工件，并使用OCI注册中心的概念来分发它们。</p>



<p>上面提到的features template repository包含了一个GitHub Actions工作流来自动化发布过程。它将每个特性打包成一个tarball，并将资产作为OCI工件发布给GHCR。</p>



<p>通过在GitHub上的库的<kbd>Actions</kbd>选项卡左侧选择模板库来触发<code>release.yaml</code>工作流。这将在<code>&lt;owner&gt;/&lt;repo&gt;</code>名称空间下向GHCR发布每个特性。仅当<code>devcontainer-feature.json</code>中的版本属性被更新时，特征才被重新发布。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h3><strong>共享开发容器特性</strong></h3>



<p>如果您希望您的贡献出现在VS代码远程开发容器或GitHub代码空间UI中，用于开发容器的创建，您可以执行以下操作:</p>



<p>转到<a href="https://containers.dev/" target="_blank" rel="noreferrer noopener"> devcontainers.github.io </a></p>



<p>打开一个PR来修改<code>collection-index.yml</code>文件</p>



<p aria-hidden="true" class="wp-block-spacer"/>





<p aria-hidden="true" class="wp-block-spacer"/>



<h2>开发容器还有什么新特性？</h2>



<p>除了新的开发容器功能repo，微软最近还开源了一个<a href="https://github.com/devcontainers/images" target="_blank" rel="noreferrer noopener">dev containers/images repository</a>，在那里他们托管了一组特定的图像，这些图像之前在<a href="https://github.com/microsoft/vscode-dev-containers" target="_blank" rel="noreferrer noopener">vs code-dev-containers repository</a>中。</p>



<p>微软团队正在为开发容器模板开发一个社区分发计划——在vscode-dev-containers中也称为“定义”——这将类似于特性。更新将在vscode-dev-containers repo中共享。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<h2><strong>了解更多关于开发容器的信息</strong></h2>



<p>如果你有兴趣了解更多关于开发容器的知识，你可以看看https://containers.dev/和T2的开发容器/规范回购。</p>



<p>在repo中，您将能够审查和评论活动的提议，如开发容器特性和特性发布的提议，并创建您自己的提议。您还可以在<code>devcontainers</code> org中的任何回购上打开问题和<a href="https://www.gitkraken.com/learn/git/tutorials/what-is-a-pull-request-in-git" target="_blank" rel="noreferrer noopener">拉请求</a>,以帮助塑造开发容器的未来。</p>



<p aria-hidden="true" class="wp-block-spacer"/>



<div class="callout">
<div class="callout-content">
<p>如果您在工作流程中使用GitHub和VS代码，请考虑使用GitLens+ for VS代码升级您的游戏，提供强大的可视化和协作功能。<br/></p>
<a href="https://www.gitkraken.com/gitlens/try-free" class="button button--basic">Download GitLens Free!</a>
</div>
</div>



<p aria-hidden="true" class="wp-block-spacer"/>



<p>本文中的信息由微软Visual Studio代码团队的高级项目经理Brigit Murtaugh提供。</p>



<p><em>联系人:brigit.murtaugh@microsoft.com；</em> <a href="https://twitter.com/brigitmurtaugh" target="_blank" rel="noreferrer noopener"> @BrigitMurtaugh <em>在推特上</em> </a></p>
		</div>
				</div>    
</body>
</html>